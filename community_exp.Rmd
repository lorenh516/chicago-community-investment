---
title: "Chicago Community Investment Exploration"
output:
    html_document:
    df_print: paged
---

```{r Housekeeping, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
# Housekeeping (clear workspace, start output file, load packages)
rm(list=ls())
# data cleaning, augmenting, manipulation
library(tidyverse)
library(dplyr)
library(haven)
library(stargazer)
library(xtable)
library(readxl)
library(astsa)
library(here)
library(Hmisc)
library(ipumsr)
library(censusapi)
library(lubridate)

# plotting tools
library(ggplot2)
library(grid)
library(ggrepel)
library(gghighlight)
library(ggalt)
library(scales)

# mapping tools
library(raster)
library(rgdal)
library(rgeos)
library(maptools)
library(ggmap)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
```


```{r include=FALSE}
# dr1iff <- sasxport.get(here("data", "DR1IFF_I.XPT"))
```


```{r include=FALSE}
# ipums_food_sec <- read.delim(here("data", "cps_00001.dat"))
```

```{r include=FALSE}
# ddi <- read_ipums_ddi(here("data", "cps_00001.xml"))
# ipums_food_sec <- read_ipums_micro(ddi)
# View(ipums_food_sec)
```


```{r include=FALSE}
# metadata <- data.frame(attr(ipums_food_sec, "names"), attr(ipums_food_sec, "variable.labels"))
# names(metadata) <- c("var.name", "variable.label")
```

```{r include=FALSE}
# library(SAScii)
# TANF09.instructions <- here("data", "tanf09", "input_TANF09a.sas")
# 
# TANF09.infile.location <- here("data", "tanf09", "TANF09A.TXT")
# 
# #store file as an R data frame
# tanf09 <- 
# 	read.SAScii ( 
# 		TANF09.infile.location, 
# 		TANF09.instructions, 
# 		zipped = F,
# 		lrecl=1210)
```



```{r include=FALSE}
#store file as an R data frame
# tanf.fwf.parameters <-  parse.SAScii(here("data", "tanf09", "input_TANF09c.sas"), beginline = 1)
# tanf09c <- 
# 	read.SAScii ( 
# 		fn= here("data", "tanf09", "TANF09C.TXT"), 
# 		sas_ri=here("data", "tanf09", "input_TANF09c.sas"), 
# 		beginline=3,
# 		zipped = F,
# 		lrecl=721)

```


```{r include=FALSE}
 # tanf09c <- SAScii::parse.SAScii( here("data", "tanf09", "input_TANF09c.sas"))
 # tanf09c$varname <- tolower( tanf09c$varname )
 #    
 #    # tanf09a <- SAScii::parse.SAScii(here("data", "tanf09", "input_TANF09a.sas"))
 #    # tanf09a$varname <- tolower( tanf09a$varname )
 #    
 #    cols_to_import <- tolower(c("FIPS", "COUNTY", "RPTMN", "ZIP", "REC_FS", "DOB1", "MARIT1", "EDUL1", "EMPLOY1"))
 #    
 #  # import fixed-width files
 #  tanf09c_df <- 
 #      data.frame( readr::read_fwf(
 #          here("data", "tanf09", "TANF09C.TXT"),
 #          readr::fwf_widths( 
 #              abs( tanf09c$width ) , col_names = tanf09c[ , 'varname' ] 
 #          ) ,
 #          col_types = 
 #              paste0( 
 #                  ifelse( !( tanf09c$varname %in% cols_to_import ) , 
 #                      "_" , 
 #                      ifelse( tanf09c$char , "c" , "d" ) 
 #                  ) , 
 #                  collapse = "" 
 #              )
 #      ) )

```

```{r import-licenses, message=FALSE, warning=FALSE}
bus_licenses <- read_csv(here::here("data", "Business_Licenses.csv"))
```

```{r view-zip-problems}
problems(bus_licenses)
```


```{r check-zip-integrity}
# investigate nonstandard zip codes
# looks like int'l businesses
bind_cols(bus_licenses[unlist(problems(bus_licenses)[, 'row']), c('LICENSE ID', 'LEGAL NAME', 'DOING BUSINESS AS NAME', 'ADDRESS', 'CITY', 'STATE', 'BUSINESS ACTIVITY')], problems(bus_licenses)[, 'actual']) %>% arrange(ADDRESS) %>% distinct(`DOING BUSINESS AS NAME`, `BUSINESS ACTIVITY`, ADDRESS, CITY, STATE, actual)
```



```{r view-bus-lic}
View(bus_licenses)
```

```{r add-lic-cols}
bus_licenses <- mutate(bus_licenses, 
                       active=ifelse(grepl("AAI",`LICENSE STATUS`),1,0),
                       app_review = difftime(mdy(`LICENSE APPROVED FOR ISSUANCE`,tz="America/Chicago"), mdy(`APPLICATION REQUIREMENTS COMPLETE`,tz="America/Chicago"),unit="days"),
                       activity_date = mdy(ifelse(is.na(`LICENSE STATUS CHANGE DATE`), `DATE ISSUED`, `LICENSE STATUS CHANGE DATE`),tz="America/Chicago"),
                       activity_month = lubridate::month(activity_date),
                       activity_yr = lubridate::year(activity_date)
                       )
```


```{r include=FALSE}
# continue looking for west/ south/ north designation for wards
west_wards <- c(1, 2, 12, 22, 24, 25, 26, 27, 28, 29, 30, 32, 37)
```




```{r pre-2015-lic}
bus_licenses %>% group_by(activity_date, WARD) %>% summarise(business_count = n()) %>% filter(activity_date < mdy("1/1/2015"), !is.na(WARD)) %>%
  ggplot() + geom_line(aes(x=activity_date, y=business_count, colour=as.factor(WARD))) +
  gghighlight(min(business_count), max_highlight = 3L) +
  labs(y="Business Count", x="Activity Date", colour="Ward", title="Chicago Ward Business Presence", caption="Data Source: Chicago Open Data Portal")
```

```{r check-2012-spike}
# look into spike around beginning of 2013
bus_licenses %>% group_by(activity_date, WARD) %>% summarise(bus_count = n()) %>% summarise(max_activity = max(bus_count)) %>% arrange(desc(max_activity))
```

```{r pre-2015-licensing}
bus_licenses %>% filter(
  activity_date < mdy("1/1/2015"), !is.na(WARD), !(activity_date== mdy("12/29/2012")), active==1) %>%
  group_by(activity_date, WARD) %>% summarise(business_count = n()) %>% 
  ggplot() + geom_line(aes(x=activity_date, y=business_count, colour=as.factor(WARD))) +
  gghighlight(min(business_count), max_highlight = 3L) +
  labs(y="Business Count", x="Activity Date", colour="Ward", title="Chicago Ward Business Presence (2002-2015)", caption="Data Source: Chicago Open Data Portal")
```


```{r save-pre-2015-licensing}
ggsave("pre_2015_licensing.pdf", width = 30, height = 15, units = "cm")
```


```{r import-former-wards}
wardsPre2015 <- shapefile(here::here("data", "Geofiles - Chicago Zip Code and Neighborhood", "Boundaries - Wards (2003-2015)", "geo_export_fa687596-87b6-4059-afac-b28ce789a674.shp"))
crs(wardsPre2015)
```


```{r import-2015-wards}

wards.shp.2015 <- here::here("data","Geofiles - Chicago Zip Code and Neighborhood","Boundaries - Wards (2015-)","geo_export_0bb2e9fd-20ca-415b-a96a-7722d72c1b41.shp")
wards2015 <- shapefile(wards.shp.2015)
# crs(wards2015)

```

```{r fortify-mapping, message=FALSE}
wards2015@data <- mutate(wards2015@data, id = rownames(wards2015@data))
wards2015.points <- fortify(wards2015, region="id")
wards2015.df <- merge(wards2015.points, wards2015@data, by="id")
```



```{r include = FALSE}

# wards2015_center.points <- gCentroid(wards2015, byid = TRUE)
# wards2015_center.df <- as.data.frame(wards2015_center.points)
# wards2015_center.df <- wards2015_center.df %>% rename(long = x, lat = y)
# wards2015_center.df <- wards2015_center.df %>% mutate(id=seq(1:50))
# left_join(wards2015_center.df, dplyr::select(.data=wards2015.df, id, ward), by.x=as.character("id"), by.y=as.character("id"))
# fortify(SpatialPointsDataFrame(coords = wards2015_center.points@coords, bbox = wards2015_center.points@bbox, data=id.df), region="id"
# wards2015_center.points = fortify(wards2015_spatial_centroid_pts, region="id")
# ggplot(data=wards2015_center.df, aes(long, lat, group=group))
```



```{r bus-locs, include =FALSE}

license_types <- c("ISSUE" = "New Business Licenses", 
                   "RENEW" = "Business License Renewals")
# 
# bus_licenses %>% filter(activity_yr >= 2009, active == 1, `APPLICATION TYPE`%in% c('ISSUE', 'RENEW')) %>% 
#   distinct(`LICENSE ID`, activity_yr, `APPLICATION TYPE`, LONGITUDE, LATITUDE) %>% 
#   ggplot() +
#   geom_point(aes(x=LONGITUDE, y=LATITUDE, color=as.factor(activity_yr)), alpha = 0.05, show.legend = FALSE, na.rm = TRUE) + 
#   geom_path(data = wards2015.df, aes(long,lat,group=group), color="black") +
#   geom_polygon(data = wards2015.df, aes(long,lat,group=group), fill=NA) +
#   coord_equal(ratio=1) + 
#   labs(y="Latitude", x="Longitude", colour="Year", title="Money in the Middle", subtitle="Virtually No New Business Entry, Renwal in Ward 9, 10, 18, or 41 since 2009", caption = "Data Source: City of Chicago Department of Business Affairs and Consumer Protection, Business Licenses (2002 to Present)") +
#   theme_minimal() + 
#   # facet_grid(. ~ `APPLICATION TYPE`) +
#   theme(
#     panel.border = element_blank(),
#     axis.text.y = element_blank(),
#     panel.grid.major.y = element_blank(),
#     panel.grid.minor.y = element_blank(),
#     axis.text.x = element_blank(),
#     panel.grid.major.x = element_blank(),
#     panel.grid.minor.x = element_blank(),
#     plot.title = element_text(size = 15, face = "bold")
#   )
#   
```


```{r save-bus-locs, warning=FALSE, include = FALSE}
# ggsave("business_locations_10yr.pdf", width = 30, height = 25, units = "cm")
```


```{r}
bus_licenses <- bus_licenses %>% mutate(activity_wk = lubridate::as_date(cut(activity_date, breaks = "week", start.on.monday = FALSE, origin = lubridate::origin)))
```



```{r post-2012-lic, warning=FALSE}
# subtitle_1 <- textGrob(expression("New Business beyond Loop (Wards 2, 42, 43, 44) Concentrated in" * phantom(bold("Pilsen")) * " and" * phantom(bold("East Garfield Park")) ),
#                  x = 2013, y = 202.1, gp = gpar(col = "black") )
# 
# subtitle_2 <- textGrob(expression(phantom("New Business beyond Loop (Wards 2, 42, 43, 44) Concentrated in") * bold("Pilsen") * phantom(", East Garfield Park") ),
#                  x = 2013, y = 202.1, gp = gpar(col = "#f67770"))
# 
# subtitle_3 <- textGrob(expression(phaontom("New Business beyond Loop (Wards 2, 42, 43, 44) Concentrated in Pilsen, ") * bold("East Garfield Park") ),
#                  x = 2013, y = 202.1, gp = gpar(col = "#1bb840"))

bus_licenses %>% filter(activity_date >= "2013-1-1", !is.na(WARD), !WARD %in% c(2, 42, 43, 44), active==1) %>%
  group_by(activity_wk, WARD) %>% summarise(business_count = n()) %>% 
  ggplot() + geom_line(aes(x=ymd(activity_wk), y=business_count, colour=as.factor(WARD))) +
  gghighlight(max(business_count), max_highlight = 2, label_key = WARD) + 
  geom_line(data = bus_licenses %>% 
               filter(activity_date >= "2013-1-1", WARD %in% c(2, 42, 43, 44), active==1) %>%
               group_by(activity_wk, WARD) %>% summarise(business_count = n()), 
             aes(x=ymd(activity_wk), y=business_count), colour="#addcfd", alpha=0.5) +
  # geom_label_repel(data = bus_licenses %>% 
  #              filter(activity_date >= "2013-1-1", WARD %in% c(2, 42, 43, 44), active==1) %>%
  #              group_by(activity_wk, WARD) %>% summarise(business_count = n()), 
  #            aes(x=ymd(activity_wk), y=business_count, label=WARD), colour="#addcfd", alpha=0.5) +
  labs(y="Business Count", x="Weekly Licenses Issued or Renewed", colour="Chicago Council Ward", title="Over Five Years of Gentrification versus Rehabilitation", subtitle="New Business beyond Loop (Wards 2, 42-44) Concentrated in Pilsen (27), East Garfield Park (25)", caption="Data Source: Chicago Open Data Portal") +
theme_minimal() + 
theme(axis.title = element_text(size = 10, face = "bold"), 
      plot.title = element_text(size = 15, face = "bold"))
# annotation_custom(grobTree(subtitle_1, subtitle_2, subtitle_3, subtitle_4))

```



```{r save-post-2012-lic}
ggsave("post2012_licensing.pdf", width = 25, height = 18, units = "cm")
```



```{r avg-monthly-lic, warning=FALSE}
bus_licenses %>% filter(!is.na(WARD), active==1) %>%
  group_by(activity_month, activity_yr, WARD) %>% 
  summarise(business_count = n()) %>% group_by(WARD) %>% 
  ggplot(aes(x=as.factor(WARD), y=business_count)) + 
  geom_boxplot(aes(group=as.factor(WARD), fill=as.factor(WARD)), alpha=0.5) + 
  scale_y_continuous(limits = c(0, 1750)) +
  scale_x_discrete(breaks=seq(0,50,5)) +
  gghighlight(median(business_count)<23|median(business_count)>125) + 
  # geom_label_repel(aes(group=as.factor(WARD), label=as.factor(WARD))) +
  labs(x="Chicago Council Ward", y="Average Monthly Business Count", caption="Data Source: Chicago Open Data Portal", title="South and West Wards Average Lowest Rate of Business Licensing for 15+ Years", subtitle="Calumet Heights and Westlawn Average less than 25 Business License Issuances per month ",fill="Ward") +
  theme_minimal()
```

```{r save-new-bus, warning=FALSE}
ggsave("avg_ward_business.pdf", width = 25, height = 18, units = "cm")
```


```{r include = FALSE}
school_cols_to_import <- c("RCDTS", "Type",	"School Name", "District",	"City",	"County",	"District Type",	"School Type",	"Grades Served",	"Summative Designation", "Student Enrollment - Total", "Student Enrollment - White %", "Student Enrollment - Black or African American %", "Student Enrollment - Hispanic or Latino %",	"Student Enrollment - Asian %", "Student Enrollment - Low Income %", "Total Number of School Days", "Student Attendance Rate", "Student Chronic Truancy Rate",	"High School Dropout Rate - Total", "High School Dropout Rate - Low Income", "High School 5-Year Graduation Rate - Total", "Avg Class Size - High School", "Avg Class Size – All Grades", "Avg Teaching Exp", "Pupil Teacher Ratio - Elementary", "Pupil Teacher Ratio - High School", "Pupil Certified Staff Ratio", "Pupil Admin Ratio", "Teacher Avg Salary", "Admin Avg Salary", "Teacher Retention Rate", "Principal Turnover within 6 Years",	"Teacher Attendace Rate", "Teacher Evaluation Rate", "Number of Students who took AP classes Grade 9 Total", "Number Low Income of Students who took AP classes Grade 9 Total", "Number of Students who took AP classes Grade 10 Total", "Number Low Income of Students who took AP classes Grade 10 Total", "Number of Students who took AP classes Grade 11 Total", "Number Low Income of Students who took AP classes Grade 11 Total", "Number of Students who took AP classes Grade 12 Total", "Number Low Income of Students who took AP classes Grade 12 Total", "Number of students who took one ore more AP Exams Grade 10", "Number of students who took one ore more AP Exams Grade 11",	"Number of students who took one ore more AP Exams Grade 12")
```


```{r include = FALSE}
# getCensus(name, vintage = NULL, key = Sys.getenv("CENSUS_KEY"), vars,
#   region = NULL, regionin = NULL, time = NULL, date = NULL,
#   period = NULL, monthly = NULL, category_code = NULL,
#   data_type_code = NULL, naics = NULL, pscode = NULL,
#   naics2012 = NULL, naics2007 = NULL, naics2002 = NULL,
#   naics1997 = NULL, sic = NULL)
# https://hrecht.github.io/censusapi/reference/getCensus.html#arguments
```


```{r include=FALSE}
# View(listCensusApis())

# View(listCensusMetadata(name = "acs/acs5", vintage = 2016, type = "geography"))


# sahie_vars <- listCensusMetadata(name = "timeseries/healthins/sahie", 
#     type = "variables")
```

```{r include=FALSE}


# acs_income <- getCensus(name = "acs/acs1",
#     vintage = 2017, 
#     vars = c("NAME", "SAEMHI_PT", "SAEMHI_MOE", "B19013_001MA"), 
#     region = "county:031",
#     regionin = "state:17",
#     time = "from 2009 to 2019")
# head(acs_income)
```


```{r message=FALSE, warning=FALSE}

register_google(key = Sys.getenv("GOOGLEMAPS_KEY"))
```


```{r}

# for (current_year in seq(2009:2019)) {
  bl <- bus_licenses %>% filter(activity_yr >= 2009, active == 1, `APPLICATION TYPE`%in% c('ISSUE', 'RENEW')) %>% 
    distinct(`LICENSE ID`, activity_yr, `APPLICATION TYPE`, LONGITUDE, LATITUDE) 
  
  # bounds <- rbind( wards2015.df %>% dplyr::select(long, lat) %>% summarise(long = max(long, na.rm = TRUE),
  #                                                  lat = max(lat, na.rm = TRUE))  ,
  #       wards2015.df %>% dplyr::select(long, lat) %>% summarise(long = min(long, na.rm = TRUE),
  #                                                  lat = min(lat, na.rm = TRUE))
  # )


  
  ggmap(get_googlemap(center = c(lon = -87.732125, lat = 41.83379),
                      zoom = 10, scale = 1,
                      maptype ='terrain',
                      color = 'color',
                      # visible=bounds,
                      key = Sys.getenv("GOOGLEMAPS_KEY"))) + 
    geom_point(data=bl, aes(x=LONGITUDE, y=LATITUDE, color=as.factor(activity_yr)), alpha = 0.05, show.legend = FALSE, na.rm = TRUE) + 
    geom_path(data = wards2015.df, aes(long,lat,group=group), color="black") +
    geom_polygon(data = wards2015.df, aes(long,lat,group=group), fill=NA) + 
    labs(y="Latitude", x="Longitude", colour="Year", title="Money in the Middle", subtitle="Virtually No New Business Entry, Renwal in Ward 9, 10, 18, or 41 since 2009", caption = "Data Source: City of Chicago Department of Business Affairs and Consumer Protection, Business Licenses") +
    theme_minimal() + 
    facet_grid(. ~ `APPLICATION TYPE`) +
    theme(
      panel.border = element_blank(),
      axis.text.y = element_blank(),
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank(),
      axis.text.x = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      plot.title = element_text(size = 15, face = "bold")
    ) +
    scale_x_continuous(limits = c(wards2015.df %>% dplyr::select(long) %>% min() - 0.1, wards2015.df %>% dplyr::select(long) %>% max() + 0.05), expand = c(0, 0)) +
    scale_y_continuous(limits = c(wards2015.df %>% dplyr::select(lat) %>% min() - 0.1, wards2015.df %>% dplyr::select(lat) %>% max()) + 0.05, expand = c(0, 0))
  # }
```



```{r}
ggsave("location_over_googlemap_zoom10.pdf", width = 36, height = 23, units = "cm")
```


```{r include = FALSE}
# reportCard13 <- read_sav(here::here("data", "rc13-spss-data.sav"))
```

```{r include = FALSE}
# reportCard13 <- reportCard13 %>% filter(DistNAME == "City of Chicago SD 299")
# reportCard13 <- reportCard13 %>% mutate(YEAR = "2013")
# report_card_vars <- data.frame(var.name=names(reportCard13), attr(reportCard13,"var.labels"))
```




```{r message=FALSE, warning=FALSE}
voter_turnout15 <- read_csv(here::here("data", "voter_turnout_city_council_2015.csv"), col_names = FALSE, skip=8)
voter_turnout15 <- voter_turnout15 %>% mutate(WARD = ifelse(
  grepl("WARD", voter_turnout15$X1), as.numeric(gsub("WARD ", "", X1)), NA
  ),
  X4 = as.numeric(gsub("%", "", X4)))
voter_turnout15 <- voter_turnout15 %>% fill(WARD)
```

```{r}
# double-check columns that look empty
voter_turnout15 %>% dplyr::select(X5, X6) %>% distinct()
```
```{r}
voter_turnout15 <- voter_turnout15 %>% dplyr::select(-c(X5, X6))
names(voter_turnout15) <- sapply(c("Precinct","Registered.2015","Ballots.2015","Turnout.2015", "WARD"), toupper)
voter_turnout15 <- voter_turnout15 %>% filter(PRECINCT !="Precinct", !grepl("WARD", PRECINCT), !is.na(PRECINCT))
```


```{r message=FALSE, warning=FALSE}
voter_turnout11 <- read_csv(here::here("data", "voter_turnout_city_council_2011.csv"), col_names = FALSE, skip=8)
voter_turnout11 <- voter_turnout11 %>% mutate(WARD = ifelse(
  grepl("WARD", voter_turnout11$X1), as.numeric(gsub("WARD ", "", X1)), NA
  ),
  X4 = as.numeric(gsub("%", "", X4)))
voter_turnout11 <- voter_turnout11 %>% fill(WARD)
```


```{r}
# double-check columns that look empty
voter_turnout11 %>% dplyr::select(X5, X6) %>% distinct()
```

```{r}
voter_turnout11 <- voter_turnout11 %>% dplyr::select(-c(X5, X6))
names(voter_turnout11) <- sapply(c("Precinct","Registered.2011","Ballots.2011","Turnout.2011", "WARD"), toupper)
voter_turnout11 <- voter_turnout11 %>% filter(PRECINCT !="Precinct", !grepl("WARD", PRECINCT), !is.na(PRECINCT))
```



```{r}

 merge(x=voter_turnout11, y=voter_turnout15) %>% filter(PRECINCT=="Total") %>% 
  ggplot(aes(x=TURNOUT.2011, xend=TURNOUT.2015, y=WARD, group=WARD)) + 
        geom_dumbbell(color="#e3e2e1", 
                      size=1.5, 
                      colour_x = "#a8ddb5",
                      colour_xend="#43a2ca") + 
        geom_vline(aes(
          xintercept = unlist(
            voter_turnout15 %>% filter(PRECINCT == "Total") %>%  summarise(m = mean(TURNOUT.2015, na.rm=TRUE))
            )
          ),
          color = "#43a2ca", size=1, alpha=0.75, linetype="dashed") +
         geom_vline(aes(
           xintercept = unlist(
             voter_turnout11 %>% filter(PRECINCT == "Total") %>% summarise(m = mean(TURNOUT.2011, na.rm=TRUE))
           )
           ),
        color = "#a8ddb5", linetype="dashed", size=1) +
      geom_text_repel(aes(label=WARD), size=3, color = "#43a2ca") +
      labs(x="Municipal Election Turnout (%)", 
           y="City Council Ward", 
           title="City-Wide Drop in Voter Turnout Could be Affecting Alderman Motivation \nto Fight Deinvestment", 
           subtitle="Historical Voter Turnout in Chicago City Council Wards", 
           caption="Source: Chicago Board of Election Commissioners") +
      scale_y_continuous(expand = c(0, 1), limits = c(0, 51)) +
      theme(plot.title = element_text(size = 15, face = "bold"),
            panel.grid.minor=element_blank(),
            panel.grid.major.y=element_blank(),
            panel.grid.major.x=element_line(),
            axis.text.y = element_blank(),
            axis.ticks=element_blank(),
            legend.position="top",
            panel.border=element_blank()) + 
      annotate("text", x=unlist(
        voter_turnout11 %>% filter(PRECINCT == "Total") %>% summarise(m = mean(TURNOUT.2011, na.rm=TRUE))
        ) + 5, y=30.5, label="2011 Average",size=3) +
      annotate("text", x=unlist(voter_turnout15 %>% filter(PRECINCT == "Total") %>% summarise(m = mean(TURNOUT.2015, na.rm=TRUE))) - 5, y=47, label="2015 Average", size = 3) +
      theme_minimal()

```


```{r}
ggsave("ward_election_turnout2011_2015.pdf", width = 36, height = 23, units = "cm")
```



